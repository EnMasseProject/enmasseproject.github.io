<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.9">
<title>Using EnMasse</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
:not(pre)>code.nobreak{word-wrap:normal}
:not(pre)>code.nowrap{white-space:nowrap}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt,.quoteblock .quoteblock{margin:0 0 1.25em;padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
td.tableblock>.content>:last-child.sidebarblock{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Documentation for EnMasse on Kubernetes</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#enmasse-overview-messaging">1. Overview</a>
<ul class="sectlevel2">
<li><a href="#features">1.1. Features</a>
<ul class="sectlevel3">
<li><a href="#standard_address_space_overview">1.1.1. Standard address space</a></li>
<li><a href="#brokered_address_space_overview">1.1.2. Brokered address space</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#quickstart-messaging-gs">2. Getting started</a>
<ul class="sectlevel2">
<li><a href="#downloading-messaging-gs">2.1. Downloading EnMasse</a></li>
<li><a href="#installing-using-bundle-messaging-gs">2.2. Installing EnMasse using a YAML bundle</a></li>
<li><a href="#create-address-space-cli-messaging-gs">2.3. Creating address spaces using the command line</a></li>
<li><a href="#create-address-cli-messaging-gs">2.4. Creating addresses using the command line</a></li>
<li><a href="#proc-creating-users-cli-messaging-gs">2.5. Creating users using the command line</a></li>
<li><a href="#send-receive-messaging-gs">2.6. Sending and receiving messages</a></li>
</ul>
</li>
<li><a href="#'service-admin-guide-messaging">3. Service admin guide</a>
<ul class="sectlevel2">
<li><a href="#installing-messaging">3.1. Installing EnMasse</a>
<ul class="sectlevel3">
<li><a href="#downloading-messaging">3.1.1. Downloading EnMasse</a></li>
<li><a href="#installing-using-bundle-messaging">3.1.2. Installing EnMasse using a YAML bundle</a></li>
<li><a href="#installing-using-olm-messaging">3.1.3. Installing EnMasse using Operator Marketplace</a></li>
</ul>
</li>
<li><a href="#configuring-messaging">3.2. Configuring EnMasse</a>
<ul class="sectlevel3">
<li><a href="#con-configuring-messaging">3.2.1. Service configuration resources and definition</a></li>
<li><a href="#minimal-service-configuration-messaging">3.2.2. Minimal service configuration</a></li>
<li><a href="#con-address-space-plans-messaging">3.2.3. Address space plans</a></li>
<li><a href="#create-address-space-plans-cli-messaging">3.2.4. Creating address space plans</a></li>
<li><a href="#con-address-plans-messaging">3.2.5. Address plans</a></li>
<li><a href="#create-address-plans-cli-messaging">3.2.6. Creating address plans</a></li>
<li><a href="#infrastructure-configuration-messaging">3.2.7. Infrastructure configuration</a></li>
<li><a href="#applying-infra-config-changes-messaging">3.2.8. Applying infrastructure configuration</a></li>
<li><a href="#con-authentication-services-messaging">3.2.9. Authentication services</a></li>
<li><a href="#proc-deploying-standard-auth-service-messaging">3.2.10. Deploying the <code>standard</code> authentication service</a></li>
<li><a href="#proc-deploying-none-auth-service-messaging">3.2.11. Deploying the <code>none</code> authentication service</a></li>
<li><a href="#con-external-authentication-service-api-messaging">3.2.12. External authentication service API</a></li>
<li><a href="#ref-example-roles-messaging">3.2.13. EnMasse example roles</a></li>
</ul>
</li>
<li><a href="#upgrading-messaging">3.3. Upgrading EnMasse</a>
<ul class="sectlevel3">
<li><a href="#upgrading-enmasse-using-bundle-messaging">3.3.1. Upgrading EnMasse using a YAML bundle</a></li>
</ul>
</li>
<li><a href="#uninstalling-messaging">3.4. Uninstalling EnMasse</a></li>
<li><a href="#monitoring-messaging">3.5. Monitoring EnMasse</a>
<ul class="sectlevel3">
<li><a href="#deploy-monitoring-operator-messaging">3.5.1. (Optional) Deploying the Application Monitoring Operator</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Welcome to the EnMasse documentation, where you can find information to help you learn about
EnMasse and start exploring its features.</p>
</div>
<div class="paragraph">
<p>From getting started to trying out more advanced installation and configuration, these resources provide
what you need to set up and manage EnMasse as a service administrator or a messaging tenant.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="enmasse-overview-messaging">1. Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>EnMasse is an open source project for managed, self-service messaging on <a href="https://kubernetes.io" target="_blank" rel="noopener">Kubernetes</a> and <a href="https://openshift.com" target="_blank" rel="noopener">OpenShift</a>. EnMasse can run on your own infrastructure or in the cloud, and simplifies running a messaging infrastructure for your organization.</p>
</div>
<div class="paragraph">
<p>The service admin can deploy and manage messaging infrastructure, while messaging tenants can request messaging resources, both using both cloud-native APIs and tools.</p>
</div>
<div class="sect2">
<h3 id="features">1.1. Features</h3>
<div class="ulist">
<ul>
<li>
<p>Built-in authentication and authorization of clients and identity management</p>
</li>
<li>
<p>Runs on Kubernetes and OpenShift: deploy on-premise or in the cloud</p>
</li>
<li>
<p>Different messaging patterns such as request-response, publish-subscribe and events</p>
</li>
<li>
<p>Decouple operation of infrastructure from configuration and use by applications</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>EnMasse can be used for many purposes, such as moving your messaging infrastructure to the cloud without depending on a specific cloud provider, building a scalable messaging backbone for IoT, or just as a cloud-ready version of a message broker.</p>
</div>
<div class="paragraph">
<p>EnMasse can provision different types of messaging depending on your use case. A user can request messaging resources by creating an <a href="http://enmasse.io/documentation/master/kubernetes/#con-address-space-messaging">address space</a>.</p>
</div>
<div class="paragraph">
<p>EnMasse currently supports a <code>standard</code> and a <code>brokered</code> address space type, each with different semantics.</p>
</div>
<div class="sect3">
<h4 id="standard_address_space_overview">1.1.1. Standard address space</h4>
<div class="paragraph">
<p>The standard address space type is the default type in EnMasse, and is focused on scaling in the number of connections and the throughput of the system. It supports AMQP and MQTT protocols, with more to come in the future. This address space type is based on other open source projects such as <a href="https://activemq.apache.org/artemis/">Apache ActiveMQ Artemis</a> and <a href="https://qpid.apache.org/components/dispatch-router/index.html">Apache Qpid Dispatch Router</a> and provides elastic scaling of these components.  This image illustrates the high-level architecture of the standard address space:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://raw.githubusercontent.com/EnMasseProject/enmasse/master/documentation/design/overview/enmasse_overall_view.png" alt="Standard Address Space">
</div>
</div>
</div>
<div class="sect3">
<h4 id="brokered_address_space_overview">1.1.2. Brokered address space</h4>
<div class="paragraph">
<p>The brokered address space type is the "classic" message broker in the cloud which supports AMQP, CORE, OpenWire, and MQTT protocols. It supports JMS with transactions, message groups, selectors on queues and so on. These features are useful for building complex messaging patterns. This address space is also more lightweight as it features only a single broker and a management console.  This image illustrates the high-level architecture of the brokered address space:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://raw.githubusercontent.com/EnMasseProject/enmasse/master/documentation/design/overview/enmasse_brokered_view.png" alt="Brokered Address Space">
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="quickstart-messaging-gs">2. Getting started</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This guide will walk through the process of setting up EnMasse on
Kubernetes with clients for sending and receiving messages.</p>
</div>
<div class="ulist">
<div class="title">Prerequisite</div>
<ul>
<li>
<p>To install EnMasse, you must have Kubernetes installed. You can use <a href="https://github.com/kubernetes/minikube">minikube</a> if you want to install EnMasse on your laptop.</p>
</li>
<li>
<p>A user on the Kubernetes cluster with <code>cluster-admin</code> permissions is required, in order to set up the required cluster roles and API services.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="downloading-messaging-gs">2.1. Downloading EnMasse</h3>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Download one of the releases from the <a href="https://github.com/EnMasseProject/enmasse/releases">GitHub repository</a> and unpack it.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="installing-using-bundle-messaging-gs">2.2. Installing EnMasse using a YAML bundle</h3>
<div class="paragraph">
<p>The simplest way to install EnMasse is to use the predefined YAML bundles.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create the namespace where you want to deploy EnMasse:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">kubectl create namespace <em>enmasse-infra</em>
kubectl config set-context $(kubectl config current-context) --namespace=<em>enmasse-infra</em></pre>
</div>
</div>
</li>
<li>
<p>Create a certificate to use with the API server. For testing purposes, you can create a self-signed certificate:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">mkdir -p api-server-cert/
openssl req -new -x509 -batch -nodes -days 11000 -subj "/O=io.enmasse/CN=api-server.<em>enmasse-infra</em>.svc.cluster.local" -out api-server-cert/tls.crt -keyout api-server-cert/tls.key</pre>
</div>
</div>
</li>
<li>
<p>Create a secret containing the API server certificate:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">kubectl create secret tls api-server-cert --cert=api-server-cert/tls.crt --key=api-server-cert/tls.key</pre>
</div>
</div>
</li>
<li>
<p>Deploy using the <code>enmasse</code> bundle:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">kubectl apply -f install/bundles/enmasse</pre>
</div>
</div>
</li>
<li>
<p>(Optional) Install example plans and infrastructure configuration:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">kubectl apply -f install/components/example-plans</pre>
</div>
</div>
</li>
<li>
<p>(Optional) Install example roles:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">kubectl apply -f install/components/example-roles</pre>
</div>
</div>
</li>
<li>
<p>(Optional) Install the <code>standard</code> authentication service:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">kubectl apply -f install/components/example-authservices/standard-authservice.yaml</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="create-address-space-cli-messaging-gs">2.3. Creating address spaces using the command line</h3>
<div class="paragraph">
<p>In EnMasse, you create address spaces using standard command-line tools.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create an address space definition:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="yaml" class="language-yaml hljs">apiVersion: enmasse.io/v1beta1
kind: AddressSpace
metadata:
  name: myspace
spec:
  type: standard
  plan: standard-unlimited</code></pre>
</div>
</div>
</li>
<li>
<p>Create the address space:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">kubectl create -f standard-address-space.yaml</pre>
</div>
</div>
</li>
<li>
<p>Check the status of the address space:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">kubectl get addressspace myspace -o jsonpath={.status.isReady}</pre>
</div>
</div>
<div class="paragraph">
<p>The address space is ready for use when the previous command outputs <code>true</code>.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="create-address-cli-messaging-gs">2.4. Creating addresses using the command line</h3>
<div class="paragraph">
<p>You can create addresses using the command line.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create an address definition:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="yaml" class="language-yaml hljs">apiVersion: enmasse.io/v1beta1
kind: Address
metadata:
    name: myspace.myqueue
spec:
    address: myqueue
    type: queue
    plan: standard-small-queue</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Prefixing the name with the address space name is required to ensure addresses from different address spaces do not collide.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Create the address:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="yaml" class="language-yaml hljs">kubectl create -f standard-small-queue.yaml</code></pre>
</div>
</div>
</li>
<li>
<p>List the addresses:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="yaml" class="language-yaml hljs">kubectl get addresses -o yaml</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="proc-creating-users-cli-messaging-gs">2.5. Creating users using the command line</h3>
<div class="paragraph">
<p>In EnMasse users can be created using standard command-line tools.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You must have already created an <a href="http://enmasse.io/documentation/master/kubernetes/#con-address-space-messaging">address space</a>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>To correctly base64 encode a password for the user definition file, run the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">echo -n password | base64 #cGFzc3dvcmQ=</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Be sure to use the <code>-n</code> parameter when running this command. Not specifying that parameter will result in an improperly coded password and cause log-in issues.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Save the user definition to a file:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="yaml" class="language-yaml hljs">apiVersion: user.enmasse.io/v1beta1
kind: MessagingUser
metadata:
  name: myspace.user1
spec:
  username: user1
  authentication:
    type: password
    password: cGFzc3dvcmQ= # Base64 encoded
  authorization:
    - addresses: ["myqueue", "queue1", "queue2", "topic*"]
      operations: ["send", "recv"]
    - addresses: ["anycast1"]
      operations: ["send"]</code></pre>
</div>
</div>
</li>
<li>
<p>Create the user and associated user permissions:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">kubectl create -f <em>user-example1.yaml</em></pre>
</div>
</div>
</li>
<li>
<p>Confirm that the user was created:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">kubectl get messagingusers</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="send-receive-messaging-gs">2.6. Sending and receiving messages</h3>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Installed <a href="https://qpid.apache.org/proton/index.html">Apache Qpid Proton</a> Python bindings.</p>
</li>
<li>
<p>An address space named <code>myspace</code> must be created.</p>
</li>
<li>
<p>An address named <code>myqueue</code> must be created.</p>
</li>
<li>
<p>A user named <code>user1</code> with password <code>password</code> must be created.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Save Python client example to a file:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="python" class="language-python hljs">from __future__ import print_function, unicode_literals
import optparse
from proton import Message
from proton.handlers import MessagingHandler
from proton.reactor import Container

class HelloWorld(MessagingHandler):
    def __init__(self, url):
        super(HelloWorld, self).__init__()
        self.url = url

    def on_start(self, event):
        event.container.create_receiver(self.url)
        event.container.create_sender(self.url)

    def on_sendable(self, event):
        event.sender.send(Message(body="Hello World!"))
        event.sender.close()

    def on_message(self, event):
        print("Received: " + event.message.body)
        event.connection.close()

parser = optparse.OptionParser(usage="usage: %prog [options]")
parser.add_option("-u", "--url", default="amqps://localhost:5672/myqueue",
                  help="url to use for sending and receiving messages")
opts, args = parser.parse_args()

try:
    Container(HelloWorld(opts.url)).run()
except KeyboardInterrupt: pass</code></pre>
</div>
</div>
</li>
<li>
<p>Retrieve the address space messaging endpoint host name:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs">kubectl get addressspace myspace -o 'jsonpath={.status.endpointStatuses[?(@.name=="messaging")].externalHost}'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Use the output as the host name in the following step.</p>
</div>
</li>
<li>
<p>Run the client:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs">python client-example1.py -u amqps://user1:password@<em>messaging.example1.com</em>:443/myqueue</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>We have seen how to set up EnMasse on Kubernetes, and how to communicate with it using an AMQP client.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="'service-admin-guide-messaging">3. Service admin guide</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The service administrator guide provides resources on how to set up and manage EnMasse,
infrastructure configuration, and plans.</p>
</div>
<div class="sect2">
<h3 id="installing-messaging">3.1. Installing EnMasse</h3>
<div class="paragraph">
<p>EnMasse can be installed by applying the YAML files using the <code>kubectl</code> command-line tool, or by using the Operator Marketplace.</p>
</div>
<div class="ulist">
<div class="title">Prerequisite</div>
<ul>
<li>
<p>To install EnMasse, you must have Kubernetes installed. You can use <a href="https://github.com/kubernetes/minikube">minikube</a> if you want to install EnMasse on your laptop.</p>
</li>
<li>
<p>A user on the Kubernetes cluster with <code>cluster-admin</code> permissions is required, in order to set up the required cluster roles and API services.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="downloading-messaging">3.1.1. Downloading EnMasse</h4>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Download one of the releases from the <a href="https://github.com/EnMasseProject/enmasse/releases">GitHub repository</a> and unpack it.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="installing-using-bundle-messaging">3.1.2. Installing EnMasse using a YAML bundle</h4>
<div class="paragraph">
<p>The simplest way to install EnMasse is to use the predefined YAML bundles.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create the namespace where you want to deploy EnMasse:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">kubectl create namespace <em>enmasse-infra</em>
kubectl config set-context $(kubectl config current-context) --namespace=<em>enmasse-infra</em></pre>
</div>
</div>
</li>
<li>
<p>Create a certificate to use with the API server. For testing purposes, you can create a self-signed certificate:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">mkdir -p api-server-cert/
openssl req -new -x509 -batch -nodes -days 11000 -subj "/O=io.enmasse/CN=api-server.<em>enmasse-infra</em>.svc.cluster.local" -out api-server-cert/tls.crt -keyout api-server-cert/tls.key</pre>
</div>
</div>
</li>
<li>
<p>Create a secret containing the API server certificate:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">kubectl create secret tls api-server-cert --cert=api-server-cert/tls.crt --key=api-server-cert/tls.key</pre>
</div>
</div>
</li>
<li>
<p>Deploy using the <code>enmasse</code> bundle:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">kubectl apply -f install/bundles/enmasse</pre>
</div>
</div>
</li>
<li>
<p>(Optional) Install example plans and infrastructure configuration:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">kubectl apply -f install/components/example-plans</pre>
</div>
</div>
</li>
<li>
<p>(Optional) Install example roles:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">kubectl apply -f install/components/example-roles</pre>
</div>
</div>
</li>
<li>
<p>(Optional) Install the <code>standard</code> authentication service:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">kubectl apply -f install/components/example-authservices/standard-authservice.yaml</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="installing-using-olm-messaging">3.1.3. Installing EnMasse using Operator Marketplace</h4>
<div class="paragraph">
<p>If the version of EnMasse you want to install is not available in the <a href="https://www.operatorhub.io" target="_blank" rel="noopener">Operator
Hub</a>, you can install a custom <code>OperatorSource</code> for EnMasse following these steps.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p><a href="https://github.com/operator-framework/operator-lifecycle-manager">Operator Lifecycle Manager</a> must be installed.</p>
</li>
<li>
<p><a href="https://github.com/operator-framework/operator-marketplace">Operator Marketplace</a> must be installed.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create an <code>OperatorSource</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">cat &lt;&lt;EOF | kubectl apply -f -
apiVersion: operators.coreos.com/v1
kind: OperatorSource
metadata:
  name: enmasse-operators
  namespace: marketplace
spec:
  type: appregistry
  endpoint: https://quay.io/cnr
  registryNamespace: enmasse
  displayName: "EnMasse Operators"
  publisher: "EnMasse"
EOF</pre>
</div>
</div>
</li>
<li>
<p>Create a <code>CatalogSourceConfig</code> to enable the operator on your Kubernetes cluster:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">cat &lt;&lt;EOF | kubectl apply -f -
apiVersion: operators.coreos.com/v1
kind: CatalogSourceConfig
metadata:
  name: installed-enmasse-operators
  namespace: marketplace
spec:
  csDisplayName: EnMasse Operators
  csPublisher: EnMasse
  packages: enmasse
  targetNamespace: operators
EOF</pre>
</div>
</div>
</li>
<li>
<p>Create a <code>Subscription</code> to install the operator and receive updates:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">cat &lt;&lt;EOF | kubectl apply -f -
apiVersion: operators.coreos.com/v1alpha1
kind: Subscription
metadata:
  name: enmasse
  namespace: operators
spec:
  channel: alpha
  name: enmasse
  source: enmasse-operators
  sourceNamespace: operators
EOF</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-messaging">3.2. Configuring EnMasse</h3>
<div class="sect3">
<h4 id="con-configuring-messaging">3.2.1. Service configuration resources and definition</h4>
<div class="paragraph">
<p>The service operator configures EnMasse by defining resources constituting the "service configuration". This configuration contains instances of the following resource types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>AuthenticationService</code>  - Describes an authentication service instance used to authenticate messaging clients.</p>
</li>
<li>
<p><code>AddressSpacePlan</code> - Describes the messaging resources available for address spaces using this plan, such as the available address plans and the amount of router and broker resources that can be used.</p>
</li>
<li>
<p><code>AddressPlan</code> - Describes the messaging resources consumed by a particular address using this plan, such as what fraction of routers and brokers an address will use and other properties that should be set for multiple addresses.</p>
</li>
<li>
<p><code>StandardInfraConfig</code> - Describes the router and broker configuration for the <code>standard</code> address space type such as memory limits, storage capacity, affinity, and more.</p>
</li>
<li>
<p><code>BrokeredInfraConfig</code> - Describes the broker configuration for the <code>brokered</code> address space type such as memory limits, storage capacity, affinity, and more.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When created, these resources define the configuration that is available to the messaging tenants.</p>
</div>
<div class="paragraph">
<p>The following diagram illustrates the relationship between the different service configuration resources (green) and how they are referenced by the messaging tenant resources (blue).</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../openshift/openshift/images/enmasse-entities.svg" alt="EnMasse entities">
</div>
</div>
</div>
<div class="sect3">
<h4 id="minimal-service-configuration-messaging">3.2.2. Minimal service configuration</h4>
<div class="paragraph">
<p>Configuring EnMasse for production takes some time and consideration. The following procedure will get
you started with a minimal service configuration. For a more complete example, navigate to the
<code>install/components/example-plans</code> folder of the EnMasse distribution. All of the commands
must be run in the namespace where EnMasse is installed.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Save the example configuration:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">apiVersion: admin.enmasse.io/v1beta1
kind: StandardInfraConfig
metadata:
  name: default
spec: {}
---
apiVersion: admin.enmasse.io/v1beta2
kind: AddressPlan
metadata:
  name: standard-small-queue
spec:
  addressType: queue
  resources:
    router: 0.01
    broker: 0.1
---
apiVersion: admin.enmasse.io/v1beta2
kind: AddressSpacePlan
metadata:
  name: standard-small
spec:
  addressSpaceType: standard
  infraConfigRef: default
  addressPlans:
  - standard-small-queue
  resourceLimits:
    router: 2.0
    broker: 3.0
    aggregate: 4.0
---
apiVersion: admin.enmasse.io/v1beta1
kind: AuthenticationService
metadata:
  name: none-authservice
spec:
  type: none</pre>
</div>
</div>
</li>
<li>
<p>Apply the example configuration:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">kubectl apply -f service-config.yaml</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="con-address-space-plans-messaging">3.2.3. Address space plans</h4>
<div class="paragraph">
<p>Address space plans are used to configure quotas and control the resources consumed by address spaces. Address space plans are configured by the EnMasse service operator and are selected by the messaging tenant when creating an address space.</p>
</div>
<div class="paragraph">
<p>EnMasse includes a default set of plans that are sufficient for most use cases.</p>
</div>
<div class="paragraph">
<p>Plans are configured as custom resources. The following example shows a plan for the standard address space:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="yaml" class="language-yaml hljs">apiVersion: admin.enmasse.io/v1beta2
kind: AddressSpacePlan
metadata:
  name: restrictive-plan
  labels:
    app: enmasse
spec:
  displayName: Restrictive Plan
  displayOrder: 0
  infraConfigRef: default <b class="conum">(1)</b>
  shortDescription: A plan with restrictive quotas
  longDescription: A plan with restrictive quotas for the standard address space
  addressSpaceType: standard <b class="conum">(2)</b>
  addressPlans: <b class="conum">(3)</b>
  - small-queue
  - small-anycast
  resourceLimits: <b class="conum">(4)</b>
    router: 2.0
    broker: 2.0
    aggregate: 2.0</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>A reference to the <code>StandardInfraConfig</code> (for the <code>standard</code> address space type) or the <code>BrokeredInfraConfig</code> (for the <code>brokered</code> address space type) describing the infrastructure deployed for address spaces using this plan.</p>
</li>
<li>
<p>The address space type this plan applies to, either <code>standard</code> or <code>brokered</code>.</p>
</li>
<li>
<p>A list of address plans available to address spaces using this plan.</p>
</li>
<li>
<p>The maximum number of routers (<code>router</code>) and brokers (<code>broker</code>) for address spaces using this plan. For the <code>brokered</code> address space type, only the <code>broker</code> field is required.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The other fields are used by the EnMasse Console UI. Note the field <code>spec.infraConfigRef</code>, which
points to an infrastructure configuration that must exist when an address space using this plan is created.
For more information about infrastructure configurations, see <a href="http://enmasse.io/documentation/master/kubernetes/#infrastructure-configuration-messaging">Infrastructure configuration</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="create-address-space-plans-cli-messaging">3.2.4. Creating address space plans</h4>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create an address space plan definition:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="yaml" class="language-yaml hljs">apiVersion: admin.enmasse.io/v1beta2
kind: AddressSpacePlan
metadata:
  name: restrictive-plan
  labels:
    app: enmasse
spec:
  displayName: Restrictive Plan
  displayOrder: 0
  infraConfigRef: default
  shortDescription: A plan with restrictive quotas
  longDescription: A plan with restrictive quotas for the standard address space
  addressSpaceType: standard
  addressPlans:
  - small-queue
  - small-anycast
  resourceLimits:
    router: 2.0
    broker: 2.0
    aggregate: 2.0</code></pre>
</div>
</div>
</li>
<li>
<p>Create the address space plan:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">kubectl create -f restrictive-plan.yaml</pre>
</div>
</div>
</li>
<li>
<p>Verify that schema has been updated and contains the plan:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">kubectl get addressspaceschema standard -o yaml</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="con-address-plans-messaging">3.2.5. Address plans</h4>
<div class="paragraph">
<p>Address plans specify the expected resource usage of a given address. The sum of the resource usage for all resource types determines the amount of infrastructure provisioned for an address space. A single router and broker pod has a maximum usage of one. If a new address requires additional resources and the resource consumption is within the address space plan limits, a new pod will be created automatically to handle the increased load.</p>
</div>
<div class="paragraph">
<p>Address plans are configured by the EnMasse service operator and are selected when creating an address.</p>
</div>
<div class="paragraph">
<p>EnMasse includes a default set of address plans that are sufficient for most use cases.</p>
</div>
<div class="paragraph">
<p>In the <a href="http://enmasse.io/documentation/master/kubernetes/#con-address-space-plans-messaging">Address space plans</a> section, the address space plan references two address plans: <code>small-queue</code> and <code>small-anycast</code>. These address plans are stored as custom resources and are defined as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="yaml" class="language-yaml hljs">apiVersion: admin.enmasse.io/v1beta2
kind: AddressPlan
metadata:
  name: small-queue
  labels:
    app: enmasse
spec:
  displayName: Small queue plan
  displayOrder: 0
  shortDescription: A plan for small queues
  longDescription: A plan for small queues that consume little resources
  addressType: queue <b class="conum">(1)</b>
  resources: <b class="conum">(2)</b>
    router: 0.2
    broker: 0.3
  partitions: 1 <b class="conum">(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The address type this plan applies to.</p>
</li>
<li>
<p>The resources consumed by addresses using this plan. The <code>router</code> field is optional for address plans referenced by a <code>brokered</code> address space plan.</p>
</li>
<li>
<p>The number of partitions that should be created for queues using this plan. Only available in the <code>standard</code> address space.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The other fields are used by the EnMasse Console UI.</p>
</div>
<div class="paragraph">
<p>A single router can support five instances of addresses and broker can support three instances of addresses with this plan. If the number of addresses with this plan increases to four, another broker is created. If it increases further to six, another router is created as well.</p>
</div>
<div class="paragraph">
<p>In the <code>standard</code> address space, address plans for the <code>queue</code> address type may contain a field
<code>partitions</code>, which allows a queue to be sharded accross multiple brokers for HA and improved performance. Specifying an amount of <code>broker</code> resource above 1 will automatically cause a queue to be partitioned.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
A sharded queue no longer guarantees message ordering.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Although the example address space plan in <a href="http://enmasse.io/documentation/master/kubernetes/#con-address-space-plans-messaging">Address space plans</a> allows two routers and two brokers to be deployed, it only allows two pods to be deployed in total. This means that the address space is restricted to three addresses with the <code>small-queue</code> plan.</p>
</div>
<div class="paragraph">
<p>The <code>small-anycast</code> plan does not consume any broker resources, and can provision two routers at the expense of not being able to create any brokers:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="yaml" class="language-yaml hljs">apiVersion: admin.enmasse.io/v1beta2
kind: AddressPlan
metadata:
  name: small-anycast
  labels:
    app: enmasse
spec:
  addressType: anycast
  resources:
    router: 0.2</code></pre>
</div>
</div>
<div class="paragraph">
<p>With this plan, up to 10 addresses can be created.</p>
</div>
</div>
<div class="sect3">
<h4 id="create-address-plans-cli-messaging">3.2.6. Creating address plans</h4>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create an address plan definition:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="yaml" class="language-yaml hljs">apiVersion: admin.enmasse.io/v1beta2
kind: AddressPlan
metadata:
  name: small-anycast
  labels:
    app: enmasse
spec:
  addressType: anycast
  resources:
    router: 0.2</code></pre>
</div>
</div>
</li>
<li>
<p>Create the address plan:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">kubectl create -f small-anycast-plan.yaml</pre>
</div>
</div>
</li>
<li>
<p>Verify that schema has been updated and contains the plan:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">kubectl get addressspaceschema standard -o yaml</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="infrastructure-configuration-messaging">3.2.7. Infrastructure configuration</h4>
<div class="paragraph">
<p>EnMasse creates infrastructure components such as routers, brokers, and consoles. These
components can be configured while the system is running, and EnMasse automatically updates
the components with the new settings. The EnMasse service operator can edit the EnMasse
default infrastructure configuration or create new configurations.</p>
</div>
<div class="paragraph">
<p>Infrastructure configurations can be referred to from one or more address space plans. For more information
about address space plans, see <a href="http://enmasse.io/documentation/master/kubernetes/#con-address-space-plans-messaging">Address space plans</a>.</p>
</div>
<div class="paragraph">
<p>Infrastructure configuration can be managed for both <code>brokered</code> and <code>standard</code> infrastructure
using <code>BrokeredInfraConfig</code> and <code>StandardInfraConfig</code> resources.</p>
</div>
<div class="sect4">
<h5 id="con-brokered-infra-config-messaging">Brokered infrastructure configuration</h5>
<div class="paragraph">
<p><code>BrokeredInfraConfig</code> resources are used to configure infrastructure deployed by <code>brokered</code> address
spaces. The brokered infrastructure configuration is referenced by address space plans in their
<code>spec.infraConfigRef</code> field. For more information, see <a href="http://enmasse.io/documentation/master/kubernetes/#con-address-space-plans-messaging">Address space plans</a>.</p>
</div>
<div class="paragraph">
<p>For detailed information about the available brokered infrastructure configuration fields, see the <a href="http://enmasse.io/documentation/master/kubernetes/#ref-brokered-infra-config-fields-messaging">Brokered infrastructure configuration fields table</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="yaml" class="language-yaml hljs">apiVersion: admin.enmasse.io/v1beta1
kind: BrokeredInfraConfig
metadata:
  name: brokered-infra-config-example
spec:
  version: "0.29-SNAPSHOT"
  admin:
    resources:
      memory: 256Mi
    podTemplate:
      metadata:
        labels:
          key: value
  broker:
    resources:
      memory: 2Gi
      storage: 100Gi
    addressFullPolicy: PAGE
    podTemplate:
      spec:
        priorityClassName: messaging</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>version</code> field specifies the EnMasse version used. When upgrading, EnMasse uses
this field to determine whether to upgrade the infrastructure to the requested version. If omitted,
the version will be assumed to be the same as the controllers reading the config.</p>
</div>
<div class="paragraph">
<p>The <code>admin</code> object specifies the settings you can configure for the <code>admin</code> components.</p>
</div>
<div class="paragraph">
<p>The <code>broker</code> object specifies the settings you can configure for the <code>broker</code> components. Changing
the <code>.broker.resources.storage</code> setting does not configure the existing broker storage size.</p>
</div>
<div class="paragraph">
<p>For both <code>admin</code> and <code>broker</code> you can configure <code>podTemplate</code> settings like <code>metadata.labels</code>,
<code>spec.priorityClassName</code>, <code>spec.tolerations</code> and <code>spec.affinity</code>.</p>
</div>
<div class="paragraph">
<p>For more information see <a href="https://kubernetes.io/docs/concepts/configuration/pod-priority-preemption/">Pod priority</a>, <a href="https://kubernetes.io/docs/concepts/configuration/taint-and-toleration/">Taints and tolerations</a>, and <a href="https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#affinity-and-anti-affinity">Affinity and anti-affinity</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="con-standard-infra-config-messaging">Standard infrastructure configuration</h5>
<div class="paragraph">
<p><code>StandardInfraConfig</code> resources are used to configure infrastructure deployed by <code>standard</code> address
spaces. The standard infrastructure configuration is referenced by address space plans in their
<code>spec.infraConfigRef</code> field. For more information, see <a href="http://enmasse.io/documentation/master/kubernetes/#con-address-space-plans-messaging">Address space plans</a>.</p>
</div>
<div class="paragraph">
<p>For detailed information about the available standard infrastructure configuration fields, see the <a href="http://enmasse.io/documentation/master/kubernetes/#ref-standard-infra-config-fields-messaging">Standard infrastructure configuration fields table</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="yaml" class="language-yaml hljs">apiVersion: admin.enmasse.io/v1beta1
kind: StandardInfraConfig
metadata:
  name: myconfig
spec:
  version: "0.29-SNAPSHOT"
  admin:
    resources:
      memory: 256Mi
  broker:
    resources:
      memory: 2Gi
      storage: 100Gi
    addressFullPolicy: PAGE
  router:
    resources:
      memory: 256Mi
    linkCapcity: 1000
    minReplicas: 1
    policy:
      maxConnections: 1000
      maxConnectionsPerHost: 1
      maxConnectionsPerUser: 10
      maxSessionsPerConnection: 10
      maxSendersPerConnection: 5
      maxReceiversPerConnection: 5
    podTemplate:
      spec:
        affinity:
          nodeAffinity:
            preferredDuringSchedulingIgnoredDuringExecution:
            - weight: 1
              preference:
              matchExpressions:
              - key: e2e-az-EastWest
                operator: In
                values:
                - e2e-az-East
                - e2e-az-West</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>version</code> field specifies the EnMasse version used. When upgrading, EnMasse uses
this field to determine whether to upgrade the infrastructure to the requested version. If omitted,
the version will be assumed to be the same as the controllers reading the config.</p>
</div>
<div class="paragraph">
<p>The <code>admin</code> object specifies the settings you can configure for the <code>admin</code> components.</p>
</div>
<div class="paragraph">
<p>The <code>broker</code> object specifies the settings you can configure for the <code>broker</code> components. Changing
the <code>.broker.resources.storage</code> setting does not configure the existing broker storage size.</p>
</div>
<div class="paragraph">
<p>The <code>router</code> object specifies the settings you can configure for the <code>router</code> components.</p>
</div>
<div class="paragraph">
<p>For <code>admin</code>, <code>broker</code> and <code>router</code> you can configure <code>podTemplate</code> settings like <code>metadata.labels</code>,
<code>spec.priorityClassName</code>, <code>spec.tolerations</code> and <code>spec.affinity</code>.</p>
</div>
<div class="paragraph">
<p>See <a href="https://kubernetes.io/docs/concepts/configuration/pod-priority-preemption/">Pod priority</a>, <a href="https://kubernetes.io/docs/concepts/configuration/taint-and-toleration/">Taints and tolerations</a>, and <a href="https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#affinity-and-anti-affinity">Affinity and anti-affinity</a> for more information.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="applying-infra-config-changes-messaging">3.2.8. Applying infrastructure configuration</h4>
<div class="paragraph">
<p>You can edit existing configurations or create new ones.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>An infrastructure configuration change that you want to apply. For more information, see <a href="http://enmasse.io/documentation/master/kubernetes/#infrastructure-configuration-messaging">Infrastructure configuration</a>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create infrastructure configuration:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="yaml" class="language-yaml hljs">apiVersion: admin.enmasse.io/v1beta1
kind: StandardInfraConfig
metadata:
  name: myconfig
spec:
  version: "0.29-SNAPSHOT"
  admin:
    resources:
      memory: 256Mi
  broker:
    resources:
      memory: 2Gi
      storage: 100Gi
    addressFullPolicy: PAGE
  router:
    resources:
      memory: 256Mi
    linkCapcity: 1000
    minReplicas: 1</code></pre>
</div>
</div>
</li>
<li>
<p>Apply the configuration changes:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">kubectl apply -f standard-infra-config-example.yaml</pre>
</div>
</div>
</li>
<li>
<p>Monitor the pods while they are restarted:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">kubectl get pods -w</pre>
</div>
</div>
<div class="paragraph">
<p>The configuration changes will be applied within a couple of minutes.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="con-authentication-services-messaging">3.2.9. Authentication services</h4>
<div class="paragraph">
<p>Authentication services are used to configure the authentication and authorization endpoints
available to messaging clients. The authentication services are configured by the EnMasse
service operator, and are specified when creating an address space.</p>
</div>
<div class="paragraph">
<p>An authentication service has a type, which can either be <code>none</code>, <code>standard</code>, or <code>external</code>. The
<code>none</code> authentication service type allows all clients to send and receive messages to any address.</p>
</div>
<div class="paragraph">
<p>The <code>standard</code> authentication service type uses a Keycloak instance to store user
credentials and access policies. This authentication service also allows managing users using the
<code>MessagingUser</code> custom resource.</p>
</div>
<div class="paragraph">
<p>The <code>external</code> authentication service allows configuring an external provider of authentication and
authorization policies through an AMQP SASL handshake. This can be used to implement a bridge for
your existing identity management system.</p>
</div>
<div class="paragraph">
<p>Authentication services are configured as custom resources. The following example shows an
authentication service of type <code>standard</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="yaml" class="language-yaml hljs">apiVersion: admin.enmasse.io/v1beta1
kind: AuthenticationService
metadata:
  name: standard
spec:
  type: standard <b class="conum">(1)</b>
  standard:
    credentialsSecret: <b class="conum">(2)</b>
      name: my-admin-credentials
    certificateSecret <b class="conum">(3)</b>
      name: my-authservice-certificate
    resources: <b class="conum">(4)</b>
      requests:
        memory: 2Gi
      limits:
        memory: 2Gi
    storage: <b class="conum">(5)</b>
      type: persistent-claim
      size: 5Gi
    datasource: <b class="conum">(6)</b>
      type: postgresql
      host: example.com
      port: 5432
      database: authdb</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The type can be specified as <code>none</code>, <code>standard</code>, or <code>external</code>.</p>
</li>
<li>
<p>(Optional) The secret must contain the <code>admin.username</code> field for the user and the <code>admin.password</code> field for the password of the Keycloak admin user. If not specified, a random password will be generated and stored in a secret.</p>
</li>
<li>
<p>(Optional on OpenShift) A custom certificate can be specified. On OpenShift, a certificate is automatically created if not specified.</p>
</li>
<li>
<p>(Optional) Resource limits for the Keycloak instance can be specified.</p>
</li>
<li>
<p>(Optional) The storage type can be specified as <code>ephemeral</code> or <code>persistent-claim</code>. For <code>persistent-claim</code>, you should also configure the size of the claim. The default type is <code>ephemeral</code>.</p>
</li>
<li>
<p>(Optional) Specifies the data source to be used by Keycloak. The default option is the embedded <code>h2</code> data source. For production usage, the <code>postgresql</code> data source is recommended.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>An <code>external</code> authentication service can be configured using the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="yaml" class="language-yaml hljs">apiVersion: admin.enmasse.io/v1beta1
kind: AuthenticationService
metadata:
  name: my-im-system
spec:
  type: external
  realm: myrealm <b class="conum">(1)</b>
  external:
    host: example.com <b class="conum">(2)</b>
    port: 5671 <b class="conum">(3)</b>
    caCertSecret: <b class="conum">(4)</b>
      name: my-ca-cert</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>(Optional) The <code>realm</code> is passed in the authentication request. If not specified, an identifier in the form of <em>namespace-addressspace</em> is used as the realm.</p>
</li>
<li>
<p>The host name of the external authentication service.</p>
</li>
<li>
<p>The port of the external authentication service.</p>
</li>
<li>
<p>(Optional) The CA certificate to trust when connecting to the authentication service.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The external authentication service must implement the API described in <a href="http://enmasse.io/documentation/master/kubernetes/#con-external-authentication-service-api-messaging">External authentication service API</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="proc-deploying-standard-auth-service-messaging">3.2.10. Deploying the <code>standard</code> authentication service</h4>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create an <code>AuthenticationService</code> definition:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="yaml" class="language-yaml hljs">apiVersion: admin.enmasse.io/v1beta1
kind: AuthenticationService
metadata:
  name: standard-authservice
spec:
  type: standard</code></pre>
</div>
</div>
</li>
<li>
<p>Deploy the authentication service:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">kubectl create -f standard-authservice.yaml</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="proc-deploying-none-auth-service-messaging">3.2.11. Deploying the <code>none</code> authentication service</h4>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create an <code>AuthenticationService</code> definition:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="yaml" class="language-yaml hljs">apiVersion: admin.enmasse.io/v1beta1
kind: AuthenticationService
metadata:
  name: none-authservice
spec:
  type: none</code></pre>
</div>
</div>
</li>
<li>
<p>Deploy the authentication service:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">kubectl create -f none-authservice.yaml</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="con-external-authentication-service-api-messaging">3.2.12. External authentication service API</h4>
<div class="paragraph">
<p>An <code>external</code> authentication service must implement an AMQP SASL handshake, read the connection
properties of the client, and respond with the expected connection properties containing the
authentication and authorization information. The authentication service is queried by the address
space components such as the router and broker, whenever a new connection is established to the
messaging endpoints.</p>
</div>
<div class="sect4">
<h5 id="authentication">Authentication</h5>
<div class="paragraph">
<p>The requested identity of the client can be read from the SASL handshake <code>username</code>. The
implementation can then authenticate the user.</p>
</div>
<div class="paragraph">
<p>The authenticated identity will be returned in the <code>authenticated-identity</code> map with the following
key/values. While this example uses JSON, it should be set as an AMQP map on the connection
property.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="json" class="language-json hljs">{
    "authenticated-identity": {
        "sub": "myid",
        "preferred_username": "myuser"
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="authorization">Authorization</h5>
<div class="paragraph">
<p>Authorization is a capability that can be requested by the client using the <code>ADDRESS-AUTHZ</code>
connection capability. If this is set on the connection, the server responds with this
capability in the offered capabilities, and add the authorization information to the connection
properties.</p>
</div>
<div class="paragraph">
<p>The authorization information is stored within a map that correlates the address to a list of operations allowed on
that address. The following connection property information contains the policies for the addresses
<code>myqueue</code> and <code>mytopic</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="json" class="language-json hljs">{
    "address-authz": {
        "myqueue": [
          "send",
          "recv"
        ],
        "mytopic": [
          "send"
        ]
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The allowed operations are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>send</code> - User can send to the address.</p>
</li>
<li>
<p><code>recv</code> - User can receive from the address.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ref-example-roles-messaging">3.2.13. EnMasse example roles</h4>
<div class="paragraph">
<p>EnMasse provides the following example roles that you can use directly or use as models to create your own roles.</p>
</div>
<div class="paragraph">
<p>For more information about service administrator resources, see the <a href="http://enmasse.io/documentation/master/kubernetes/#ref-resources-table-service-admin-messaging">EnMasse service administrator resources table</a>.
For more information about messaging tenant resources, see the <a href="http://enmasse.io/documentation/master/kubernetes/#ref-resources-table-messaging-tenant-messaging">EnMasse messaging tenant resources table</a>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. EnMasse example roles table</caption>
<colgroup>
<col style="width: 40%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Role</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>enmasse.io:tenant-view</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Specifies <code>get</code> and <code>list</code> permissions for <code>addresses</code>, <code>addressspaces</code>, <code>addressspaceschemas</code>, and <code>messagingusers</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>enmasse.io:tenant-edit</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Specifies <code>create</code>, <code>get</code>, <code>update</code>, <code>delete</code>, <code>list</code>, <code>watch</code>, and <code>patch</code> permissions for <code>addresses</code>, <code>addressspaces</code>, and <code>messagingusers</code>; <code>get</code> and <code>list</code> permissions for <code>addressspaceschemas</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>service-admin</code> cluster role</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Specifies <code>create</code>, <code>get</code>, <code>update</code>, <code>delete</code>, <code>list</code>, <code>watch</code>, and <code>patch</code> permissions for <code>addressplans</code>, <code>addressspaceplans</code>, <code>brokeredinfraconfigs</code>, and <code>standardinfraconfigs</code></p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="upgrading-messaging">3.3. Upgrading EnMasse</h3>
<div class="paragraph">
<p>EnMasse supports upgrades between minor versions using cloud native tools and the same
mechanism used to apply configuration changes.  When upgrading, the updated infrastructure
configuration of the new version will trigger the upgrade to start.</p>
</div>
<div class="paragraph">
<p>Upgrading EnMasse is done by applying the YAML files for the new version.</p>
</div>
<div class="sect3">
<h4 id="upgrading-enmasse-using-bundle-messaging">3.3.1. Upgrading EnMasse using a YAML bundle</h4>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A new release of EnMasse. For more information, see <a href="http://enmasse.io/documentation/master/kubernetes/#downloading-messaging">Downloading EnMasse</a>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Select the namespace where EnMasse is installed:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">kubectl config set-context $(kubectl config current-context) --namespace=<em>enmasse-infra</em></pre>
</div>
</div>
</li>
<li>
<p>Apply the new release bundle:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">kubectl apply -f install/bundles/enmasse</pre>
</div>
</div>
</li>
<li>
<p>Monitor pods while they are restarted:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">kubectl get pods -w</pre>
</div>
</div>
<div class="paragraph">
<p>The upgrade should cause all pods to be restarted within a couple of minutes.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="uninstalling-messaging">3.4. Uninstalling EnMasse</h3>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Delete "cluster level" resources:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">kubectl delete clusterrolebindings -l app=enmasse
kubectl delete crd -l app=enmasse
kubectl delete clusterroles -l app=enmasse
kubectl delete apiservices -l app=enmasse</pre>
</div>
</div>
</li>
<li>
<p>Delete the namespace where EnMasse is deployed:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">kubectl delete namespace <em>enmasse-infra</em></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="monitoring-messaging">3.5. Monitoring EnMasse</h3>
<div class="paragraph">
<p>You can monitor EnMasse by deploying built-in monitoring tools or using your pre-existing monitoring infrastructure by deploying the required service monitors and Prometheus rules.</p>
</div>
<div class="sect3">
<h4 id="deploy-monitoring-operator-messaging">3.5.1. (Optional) Deploying the Application Monitoring Operator</h4>
<div class="paragraph">
<p>To monitor EnMasse, an operator that acts on the monitoring Custom Resource Definitions must
be deployed. You may skip this step if you have such an operator installed on your Kubernetes
cluster.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2019-05-28 08:09:51 UTC
</div>
</div>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/github.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js"></script>
<script>hljs.initHighlighting()</script>
</body>
</html>